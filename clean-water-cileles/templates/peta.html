<script>
    var map = L.map('map').setView([-6.93, 107.77], 15);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    function markerColor(status) {
        if (status === "AMAN") return "green";
        if (status === "ASAM") return "red";
        return "orange";
    }

    var lokasi = {{ lokasi | tojson | safe }};

    if (lokasi.length > 0) {
        lokasi.forEach(function(d) {
            var color = markerColor(d.status);

            var marker = L.circleMarker([d.lat, d.lon], {
                radius: 10,
                fillColor: color,
                color: "#fff",
                weight: 2,
                opacity: 1,
                fillOpacity: 0.9
            }).addTo(map);

            marker.bindPopup(`
                <b>${d.rumah}</b><br>
                Status Air: <b>${d.status}</b><br><br>
                <i>Pengukuran pH, EC, dan TDS</i>
            `);
        });
    }
</script>
